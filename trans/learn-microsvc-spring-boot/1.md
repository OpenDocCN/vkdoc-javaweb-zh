# 一、设置场景

微服务如今越来越受欢迎，应用也越来越广泛。这并不令人惊讶；这种软件架构风格有很多优点，比如灵活性和易于扩展。将微服务映射到一个组织中的小团队中也可以提高开发效率。然而，继续只知道好处的微服务冒险是一个错误的决定。分布式系统引入了额外的复杂性，因此您需要了解您所面临的情况，并提前做好准备。你可以从互联网上的许多书籍和文章中获得许多知识，但当你亲自动手编写代码时，情况就变了。

这本书以实用的方式涵盖了微服务的一些最重要的概念，但没有解释这些概念。首先，我们定义一个用例:要构建的应用程序。然后我们从一个小的整体开始，基于一些合理的推理。一旦我们有了最少的应用程序，我们就会评估是否值得迁移到微服务，以及迁移的好方法是什么。随着第二个微服务的引入，我们分析了他们通信的选项。然后，我们可以描述和实现事件驱动架构模式，通过通知系统的其他部分*发生了什么*，而不是显式地调用其他部分来采取行动，从而实现松散耦合。当我们达到这一点时，我们注意到一个设计糟糕的分布式系统有一些缺陷，我们必须用一些流行的模式来修复:服务发现、路由、负载平衡、可追溯性等等。将它们一个一个地添加到我们的代码库中，而不是将它们一起呈现，有助于我们理解这些模式。我们还使用 Docker 为云部署准备了这些微服务，并比较了运行应用程序的不同平台选择。

一步一步来的好处是，当需要解决概念的时候停下来，你会明白每个工具试图解决哪个问题。这就是为什么进化的例子是这本书的重要部分。您也可以不用编写一行代码就能理解这些概念，因为源代码在整个章节中都有介绍和解释。

本书包含的所有代码都可以在 GitHub 上的项目书-微服务-v2 中找到。有多个可用的存储库，分为章和节，这使您更容易看到应用程序是如何发展的。这本书包括每一部分所涉及的版本的注释。

## 你是谁？

让我们先从这个开始:这本书对你来说有多有趣？这本书很实用，我们来玩这个游戏吧。如果你认同这些陈述中的任何一个，这本书可能对你有好处:

*   “我想学习如何用 Spring Boot 构建微服务，以及如何使用相关工具。”

*   “每个人都在谈论微服务，但我还不知道什么是微服务。我只读过理论性的解释或炒作的文章。尽管我在 IT 行业工作，但我无法理解它的优势……”

*   “我想学习如何设计和开发 Spring Boot 应用程序，但我找到的要么是带有太简单示例的快速入门指南，要么是类似于官方文档的冗长书籍。我希望通过更现实的项目导向方法来学习这些概念。”

*   “我找到了一份新工作，他们正在使用微服务架构。我一直主要从事大型单体项目，所以我希望获得一些知识和指导，以了解那里的一切是如何工作的，以及这种架构的利弊。”

*   “每次我去自助餐厅，开发人员都在谈论微服务、网关、服务发现、容器、弹性模式等。如果我不明白同事们在说什么，我就无法再与他们交往。”(这个是个笑话；不要因为这个而读这本书，尤其是如果你对编程不感兴趣的话。)

关于阅读本书所需的知识，以下主题你应该很熟悉:

*   Java(我们用 Java 14)

*   Spring(你不需要很强的经验，但是你至少应该知道依赖注入是如何工作的)

*   Maven(如果你了解 Gradle，你也会很好)

## 这本书与其他书籍和指南有什么不同？

软件开发人员和架构师阅读许多技术书籍和指南，要么是因为我们对学习新技术感兴趣，要么是因为我们的工作需要它。我们无论如何都需要这样做，因为这是一个不断变化的世界。我们可以在那里找到各种各样的书籍和指南。好的通常是那些能让你快速学习的，不仅能教会你如何做事，还能教会你为什么要那样做。仅仅因为新技术是新的就使用新技术是错误的做法；你需要理解它们背后的原因，这样你才能以最好的方式使用它们。

这本书使用了这种哲学:它浏览了代码和设计模式，解释了遵循一种方法而不遵循其他方法的原因。

### 学习:一个渐进的过程

如果你看看网上的指南，你会很快注意到它们不是现实生活中的例子。通常，当你将这些案例应用到更复杂的场景时，它们并不适合。指南太肤浅，无法帮助你建立一些真实的东西。

另一方面，书在这方面做得更好。有很多好书围绕一个例子解释概念；它们很好，因为如果你看不到代码，将理论概念应用于代码并不总是容易的。这些书中有些书的问题是它们不如指南实用。您需要首先阅读它们来理解概念，然后编写(或查看)示例，这通常是作为一个整体给出的。当你直接看到最终版本时，很难将概念付诸实践。这本书停留在实践方面，从代码开始，通过章节发展，以便你一个一个地掌握概念。我们在暴露解决方案之前先掩盖问题。

由于这种增量式的概念呈现方式，这本书也允许你边学习边编码，并自己思考面临的挑战。

### 这是一本指南还是一本书？

你面前的这些页面不能被称为指南:你不会花 15 或 30 分钟来完成它们。此外，每章都介绍了所有必需的主题，为添加新代码奠定基础。但这也不是一本典型的书，在这本书中，你会经历一些孤立的概念，并用一些分散的代码片段来说明，这些代码片段是专门为这种情况而制作的。相反，您从一个现实生活中还不是最佳的应用程序开始，在了解了您可以从该过程中获得的好处之后，您将学习如何改进它。

这并不意味着你不能只是坐下来阅读它，但是如果你同时编码并使用所提供的选项和选择会更好。这是这本书的一部分，使它类似于指南。

无论如何，为了简单起见，从现在开始我们称它为一本书。

## 从基础到高级主题

这本书首先关注一些基本概念来理解其余的主题(第[章第 2](2.html) ): Spring Boot、测试、日志等等。然后，它涵盖了如何使用众所周知的分层设计来设计和实现生产就绪的 Spring Boot 应用程序，并深入到如何实现 REST API、业务逻辑和数据库存储库(第 [3](3.html) 和 [5](5.html) 章)。在这样做的时候，你会看到 Spring Boot 内部是如何工作的，所以它对你来说不再是魔法了。您还将学习如何用 React 构建一个基本的前端应用程序(第 [4](4.html) 章)，因为这将帮助您直观地了解后端架构如何影响前端。在那之后，这本书进入了微服务世界，在一个不同的 Spring Boot 应用程序中引入了第二个功能。这个实例可以帮助您分析在决定迁移到微服务之前应该考虑的因素(第 [6](6.html) 章)。然后，您将了解同步和异步通信微服务之间的区别，以及事件驱动架构如何帮助您保持系统组件的解耦(第 [7](7.html) 章)。从那里开始，这本书将带您经历适用于分布式系统的工具和框架之旅，以实现重要的非功能性需求:弹性、可伸缩性、可追溯性和部署到云中等等(第[章第 8](8.html) 节)。

如果您已经熟悉了 Spring Boot 应用程序及其工作原理，您可以快速浏览前几章，将注意力更多地放在本书的第二部分。在那里，我们涵盖了更高级的主题，如事件驱动设计、服务发现、路由、分布式跟踪、Cucumber 测试等。然而，请注意我们在第一部分中建立的基础:测试驱动的开发，对最小可行产品(MVP)的关注，以及整体优先。

### 骷髅尖兵带着 Spring Boot，专业的道

首先，这本书指导你使用 Spring Boot 创建一个应用程序。所有内容主要集中在后端，但是您将使用 React 创建一个简单的 web 页面来演示如何将公开的功能用作 REST API。

需要指出的是，我们创建“快捷代码”并不仅仅是为了展示 Spring Boot 的特性:这不是本书的目的。我们使用 Spring Boot 作为教授概念的工具，但是我们可以使用任何其他的框架，这本书的思想仍然有效。

您将学习如何按照众所周知的三层模式设计和实现应用程序。您可以通过一个增量示例和实际操作代码来实现这一点。在编写应用程序时，我们还会暂停几次，深入了解 Spring Boot 如何用这么少的代码工作的细节(自动配置、启动器等)。).

### 测试驱动开发

在第一章中，我们使用测试驱动开发(TDD)来将前提条件映射到技术特性。这本书试图以一种你可以从一开始就看到好处的方式展示这种技术:为什么在编写代码之前考虑测试用例总是一个好主意。JUnit 5、AssertJ 和 Mockito 将帮助我们高效地构建有用的测试。

计划如下:您将学习如何首先创建测试，然后使它们失败，最后实现使它们工作的逻辑。

### 微服务

一旦你的第一个应用程序准备好了，我们将引入第二个应用程序，它将与现有的功能进行交互。从那时起，您将拥有一个微服务架构。如果你只有其中一项，那么试图去了解微服务的优势是没有任何意义的。现实生活中的场景总是功能被分割成不同服务的分布式系统。像往常一样，为了保持实用性，我们将为我们的案例研究分析具体情况，以便您了解迁移到微服务是否符合您的需求。

这本书不仅涵盖了拆分系统的原因，还涵盖了这种选择带来的弊端。一旦决定迁移到微服务，您将了解应该使用哪些模式来为分布式系统构建良好的架构:服务发现、路由、负载平衡、分布式跟踪、容器化和其他一些支持机制。

### 事件驱动系统

微服务不一定需要的另一个概念是*事件驱动架构*。本书使用它，因为它是一种非常适合微服务架构的模式，并且您将基于好的示例做出选择。您将看到同步和异步通信之间的区别，以及它们的主要优缺点。

这种异步的思维方式引入了新的代码设计方式，最终一致性是要接受的关键变化之一。您将在编写项目代码时看到它，使用 RabbitMQ 在微服务之间发送和接收消息。

### 非功能需求

当您在现实世界中构建应用程序时，您必须考虑一些与功能没有直接关系的需求，但是这些需求使您的系统更加健壮，在出现故障的情况下继续工作，或者确保数据完整性，例如。

许多这些*非功能性需求*都与软件可能出错的事情有关:网络故障导致部分系统无法访问，高流量导致后端容量崩溃，外部服务没有响应，等等。

在本书中，您将学习如何实现和验证模式，以使系统更具弹性和可伸缩性。此外，我们将讨论数据完整性的重要性以及帮助我们保证数据完整性的工具。

学习如何设计和解决所有这些非功能性需求的好处在于，它是适用于任何系统的知识，不管您使用的是什么编程语言和框架。

## 在线内容

对于这本书的第二版，我决定创建一个在线空间，在那里您可以不断学习与微服务架构相关的新主题。在这个网页上，您将找到新的指南，这些指南扩展了涵盖分布式系统其他重要方面的实际用例。此外，使用最新依赖项的新版本存储库将在那里发布。

你可以在网上找到的第一个指南是关于用 Cucumber 测试分布式系统的。这个框架帮助我们构建人类可读的测试脚本，以确保我们的功能端到端地工作。

请访问 [`https://tpd.io/book-extra`](https://tpd.io/book-extra) 了解关于这本书的所有额外内容和新更新。

## 摘要

本章介绍了这本书的主要目标:通过简单的开始，然后通过开发一个示例项目来增长你的知识，来教你微服务架构的主要方面。

我们还简要介绍了这本书的主要内容:从 monolith-first 到 Spring Boot 的微服务，测试驱动开发，事件驱动系统，通用架构模式，非功能需求，以及 Cucumber 的端到端测试(在线)。

下一章将从我们学习道路的第一步开始:复习一些基本概念。